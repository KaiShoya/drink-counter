# ❓ QA リスト & 未決定事項

**最終更新**: 2025-12-10  
**ステータス**: Active  
**関連**: TASK_LIST.md, agent-documentation-workflow.md

---

## [アーキテクチャ] 質問と回答

### Q1: グローバルストアと data ストアの責務分離

**質問**: Data Store で複数のリポジトリを呼び出す場合、Page Store か Data Store どちらで集約すべきか？

**回答**: Data Store では単一のリポジトリのみを呼び出し、集約は Page Store で実施する。Data Store は「データベーステーブルをミラーリング」することに集中。

**決定日**: 2025-12-10  
**詳細**: state-management.md 参照

---

### Q2: ローカル composable vs Pinia ストア

**質問**: ローカルな一時状態（フォーム入力、UI トグル）は `ref` で管理すべき？Pinia？

**回答**: 
- **ページ状態**: Pinia で管理（page store）
- **コンポーネント状態**: 基本は `ref` で管理。複雑な状態管理が必要な場合のみ Pinia を使用

**決定日**: 2025-12-10（更新）  
**詳細**: architecture.md「各層の責務」参照
**例**：
- ✅ ページ全体の状態（フォームデータ、ローディング、エラー）→ Pinia (page store)
- ✅ コンポーネント内の UI トグル（モーダル表示/非表示）→ `ref`
- ⚠️ 複雑なコンポーネント（複数子要素の状態同期が必要）→ Pinia (store で composable化)

---

## [API・通信] 質問と回答

### Q3: リトライロジック

**質問**: Supabase API 呼び出しでタイムアウトやネットワークエラーが発生した場合、リトライ？即座にエラー表示？

**回答**: 未決定 → `.agent/specs/api-communication.md` で仕様化予定

**優先度**: 中  
**影響範囲**: すべてのリポジトリメソッド

---

### Q4: キャッシング戦略

**質問**: 月次集計データなど、頻繁には変わらないデータはクライアント側でキャッシュすべき？

**回答**: 未決定 → パフォーマンス検証後に `.agent/specs/state-management.md` に追記

**優先度**: 低  
**実装時期**: v2.0 計画時

---

## [UI・UX] 質問と回答

### Q5: トースト表示のタイミング

**質問**: 成功トーストは何秒表示？複数同時表示は可能？

**回答**: 確認中 → `app/utils/toast.ts` の実装と `features.md` を整合させる

**決定日**: TBD  
**参考**: Page Store 実装で各操作のトースト表示を検証

---

### Q6: ローディング UI の UX

**質問**: グローバルなローディング表示 vs アクション毎のローディング？

**回答**: グローバル `isLoading` 状態で一元管理（現在の実装）。ただし、大規模データ操作では詳細なプログレス表示を検討。

**決定日**: 2025-12-10  
**詳細**: state-management.md / features.md 参照

---

## [テスト] 質問と回答

### Q7: テストカバレッジ目標

**質問**: ユニットテスト・統合テスト・E2E テストの目標カバレッジは？

**回答**: 未決定 → `.agent/specs/testing-strategy.md` で定義予定  
- 提案: ユニット 80%、統合 50%、E2E 主要フロー 100%

**優先度**: 高  
**実装時期**: v1.5 計画

---

### Q8: Vitest vs Playwright

**質問**: E2E テストツールは Playwright, Cypress, Nightwatch のどれを採用？

**回答**: 未決定 → 各ツール検証後に決定  
- Playwright: 推奨（Nuxt コミュニティで人気）

**優先度**: 中  
**検証担当**: TBD

---

## [国際化] 質問と回答

### Q9: 多言語対応の今後

**質問**: 現在 ja/en の2言語だが、今後追加予定は？

**回答**: 当面は ja/en の2言語に絞る。他言語対応は今のところ予定なし。

**決定日**: 2025-12-10（確定）  
**詳細**: copilot-instructions.md 参照

---

## [セキュリティ] 未決定事項

- [ ] **RLS ポリシーの監査**: データベースセキュリティの完全性検証
  - **影響**: ユーザーデータの隔離
  - **優先度**: 高
  - **関連**: data-model.md

- [ ] **シークレット管理**: Vercel/GitHub Secrets の定期ローテーション戦略
  - **影響**: インフラセキュリティ
  - **優先度**: 中
  - **実装時期**: CI/CD パイプライン改善時

- [ ] **CSRF 対策**: Nuxt のビルトイン CSRF 保護が十分か確認
  - **影響**: Web フォーム操作
  - **優先度**: 低
  - **参考**: Nuxt セキュリティガイド確認

---

## [パフォーマンス] 未決定事項

- [ ] **バンドルサイズ最適化**: 現在のサイズ測定と削減目標
  - **目標**: LCP < 2.5s, FID < 100ms
  - **検証ツール**: Web Vitals, Lighthouse
  - **優先度**: 中

- [ ] **画像最適化**: アバター画像などの WebP 化
  - **影響**: ネットワーク帯域
  - **優先度**: 低

- [ ] **遅延ロード**: 大規模データセット（月次グラフ）の遅延ロード戦略
  - **影響**: ページロード速度
  - **優先度**: 中
  - **関連**: features.md 参照

---

## [ビルド・デプロイ] 未決定事項

- [ ] **ビルド時間短縮**: 現在のビルド時間測定と最適化
  - **ターゲット**: < 1 分
  - **優先度**: 中

- [ ] **プレビュー環境**: Vercel Preview Deployment の活用
  - **影響**: PR レビュー効率化
  - **優先度**: 低

- [ ] **環境別設定の自動化**: 開発/ステージング/本番の設定管理
  - **影響**: デプロイメント安全性
  - **優先度**: 中

---

## ステータス別リスト

### ✅ 決定済み（実装ガイドラインとして確定）

- Store 責務分離（data/page/global）
- エラーハンドリング階層図
- i18n キーの定数化戦略
- 認証フロー（OAuth + JWT）
- タイムゾーン処理方法

### 🔄 進行中（仕様書作成予定）

- API・ネットワーク通信仕様
- コンポーネント設計ガイド
- テスト戦略とカバレッジ
- パフォーマンス最適化計画
- CI/CD パイプライン定義

### ⏳ 未決定（要議論）

- テストツール選定（Playwright vs Cypress）
- キャッシング戦略の詳細
- リトライロジック実装
- マルチ言語拡張方針
- グループシェア機能の仕様

---

## アクションアイテム（次ステップ）

1. **API 通信仕様書作成**: タイムアウト、リトライ、キャッシング戦略を定義
   - **期限**: 2025-12-17
   - **担当**: TBD

2. **テスト戦略の策定**: カバレッジ目標とテストツール決定
   - **期限**: 2025-12-20
   - **担当**: TBD

3. **パフォーマンス基準値の測定**: 現在のビルド時間・バンドルサイズ・LCP を測定
   - **期限**: 2025-12-15
   - **担当**: TBD

4. **セキュリティ監査**: RLS ポリシーの完全性確認
   - **期限**: 2025-12-31
   - **担当**: TBD

---

**更新ルール**:
- 新しい Question/Decision が発生したら適時追加
- 決定済みの項目は `.agent/specs/` に移行
- 3ヶ月ごとに見直し・整理
