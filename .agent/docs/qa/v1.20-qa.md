# ❓ QA リスト v1.20

**最終更新**: 2025-12-13  
**バージョン**: 1.20.x  
**ステータス**: Active  
**テーマ**: UX対応 + メイン機能補強に関する Q&A  
**関連**: qa-index.md, agent-documentation-workflow.md

---

## 実装予定の機能に関する Q&A

### [UI/UX] Issue #291: ダークモード対応の実装

**Question**: テーマ切り替えはどのタイミングで自動適用する？OS 設定 or ユーザー明示的選択？

**Answer**: 初回は OS の `prefers-color-scheme` を採用。ユーザーが明示的にテーマを選択した後は、その選択（light/dark）を優先しストレージに保持（再訪時も継続）。システム追従オプションは提供せず、シンプルな light/dark 切り替えのみ。

**Decided on**: 2025-12-13 (updated 2025-12-13)

**優先度**: 中  
**関連**: #291

---

### [UI/UX] Issue #292: オフラインサポート実装時の同期戦略

**Question**: オフラインで記録したデータを再接続時に自動同期？ユーザー確認後？

**Answer**: 未決定 → Issue #292 のコメントで決定予定

**優先度**: 中  
**影響範囲**: データ一貫性

---

## 汎用的な設計決定（v1.20 以降で適用）

### [アーキテクチャ] グローバルストアと data ストアの責務分離

**Question**: Data Store で複数のリポジトリを呼び出す場合、Page Store か Data Store どちらで集約すべきか？

**Answer**: Data Store では単一のリポジトリのみを呼び出し、集約は Page Store で実施する。Data Store は「データベーステーブルをミラーリング」することに集中。

**Decided on**: 2025-12-10  
**Related**: state-management.md

---

### [アーキテクチャ] ローカル composable vs Pinia ストア

**Question**: ローカルな一時状態（フォーム入力、UI トグル）は `ref` で管理すべき？Pinia？

**Answer**: 
- **ページ状態**: Pinia で管理（page store）
- **コンポーネント状態**: 基本は `ref` で管理。複雑な状態管理が必要な場合のみ Pinia を使用

**Decided on**: 2025-12-10  
**Related**: architecture.md「各層の責務」参照

**Examples**:
- ✅ ページ全体の状態（フォームデータ、ローディング、エラー）→ Pinia (page store)
- ✅ コンポーネント内の UI トグル（モーダル表示/非表示）→ `ref`
- ⚠️ 複雑なコンポーネント（複数子要素の状態同期が必要）→ Pinia (store で composable化)

---

### [UI/UX] ローディング UI の UX

**Question**: グローバルなローディング表示 vs アクション毎のローディング？

**Answer**: グローバル `isLoading` 状態で一元管理（現在の実装）。ただし、大規模データ操作では詳細なプログレス表示を検討。

**Decided on**: 2025-12-10  
**Related**: state-management.md / features.md

---

### [アーキテクチャ] Repository の配置場所
 
 **Question**: リポジトリの実装ファイルは `app/repositories/` と `app/utils/api/` のどちらに置くべきか？
 
 **Answer**: `app/repositories/` に配置する。`app/repositories/` の方が直感的であるため、`app/utils/api/` は使用しない。
 
 **Decided on**: 2025-12-13
 **Related**: architecture.md
 
 ---
 
 ### [設計] 月次集計のリファクタリング戦略 (Step 1)
 
 **Question**: 既存の集計ロジックをすべて Database Functions に移行すべきか、アプリケーション層に残すべきか？
 
 **Answer**: 段階的に移行する。Step 1 では、Repository に `fetchByPeriod` を実装して期間データの取得を抽象化し、集計ロジック自体は Store (`monthlySummary/actions.ts`) に残す（Hybrid アプローチ）。UI で必要な詳細データ（カレンダー表示用の日次データなど）も同時に取得できるため。
 
 **Decided on**: 2025-12-13
 **Related**: #125

 ### [UI/UX] 月次集計画面の改善提案（KPI, Calendar, Chart）

 **Question**: 現状の実装（`monthlySummary` ストア）と UI（`monthly.vue`）にギャップがあるが、どの機能を追加すべきか？

 **Answer**:
 1. **KPI**: 平均杯数（1日あたり/飲酒日あたり）を追加する（ストア計算済み）。
 2. **Calendar**: 閾値を超えた日（飲み過ぎ）を強調表示する（`overGoal` フラグ使用）。
 3. **Graph**: 曜日別の傾向把握のため、テーブルに加えグラフ表示を追加する。
 4. **MoM**: 前月比の増減を色やアイコンで直感的にする。

 **Decided on**: 2025-12-13
 **Related**: #125
 
 ---
 
 ## Notes

- GitHub Issues とこのファイルは連携・同期させる
- 決定済み Q&A は `.agent/specs/` に統合する
- 3ヶ月ごとに見直し・整理
