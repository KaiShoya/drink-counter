# 📋 ドキュメント管理とタスク管理

## ディレクトリ構造

このプロジェクトでは、エージェント駆動のドキュメント管理に `.agent/` ディレクトリを使用します:

```
.agent/
  ├── docs/       # 作業用ドキュメント（QA、タスク、未決定事項）
  └── specs/      # 仕様の信頼できる情報源
```

**重要**: プロジェクトに `.agent/` ディレクトリが存在しない場合、必要に応じて自動的に作成してください。

## 📝 ドキュメント管理ガイドライン

### `.agent/docs/` - 作業用ドキュメント

このディレクトリの用途:
- **QA リスト**: カテゴリ付きの質問と回答形式
  - 形式: `## [カテゴリ] 質問` → `**回答**: ...`
  - カテゴリ例: `[API]`, `[UI]`, `[アーキテクチャ]`, `[テスト]` など
- **未決定事項**: 今後の議論で解決すべき未解決の問題
  - 形式: `- [ ] 問題の説明（コンテキスト、影響、選択肢）`
- **タスクリスト**: GitHub Issues と連携した開発タスク
  - 形式: `- [ ] タスクの説明 #issue_number`

**推奨される QA 形式**:
```markdown
## [カテゴリ] 質問のタイトル

**質問**: 詳細な質問の説明

**回答**: 根拠を含めた回答

**決定日**: YYYY-MM-DD
**関連**: #issue_number（該当する場合）
```

### `.agent/specs/` - 仕様（信頼できる情報源）

このディレクトリには、システムの**現在の状態**を表す確定済みの仕様が含まれます。

**対象範囲**: アーキテクチャ、API設計、データモデル、ビジネスロジック、システム全体の仕様。

**対象外**: コンポーネント単位や画面単位の仕様は、コンポーネントファイル内のカスタム `<spec>` ブロックで管理します。

**重要なルール**: コードを変更した場合、`.agent/specs/` も**必ず**更新してください。

## 🔄 ワークフロー

### チャットでのやり取り中

1. **要件を明確化**: 会話内で Q&A を通じて要件を詰める
2. **決定事項を記録**: 区切りの良いタイミングで `.agent/docs/` に記録
3. **仕様を更新**: 決定事項が確定したら `.agent/specs/` を更新
4. **GitHub Issues にリンク**: タスク追跡のために Issue と紐付け

### コードを変更する場合

**必ずこの順序に従ってください**:

1. ✅ コード変更を実装
2. ✅ 関連する `.agent/specs/` ファイルを更新
3. ✅ コミットメッセージに仕様更新を記載
4. ✅ （PR の場合）PR の説明に仕様変更を含める

**コミットメッセージの例**:
```
feat: 日付範囲によるドリンクフィルタリングを追加

- DrinksRepository にフィルタロジックを実装
- UI コンポーネントを更新
- .agent/specs/drinks-api.md に新しいエンドポイントを追加
```

### PR レビューチェックリスト

PR を作成またはレビューする際は、以下を確認してください:

- [ ] コード変更が実装されている
- [ ] テストが追加/更新されている
- [ ] 仕様が変更された場合、`.agent/specs/` が更新されている
- [ ] 関連する GitHub Issues がリンクされている
- [ ] 必要に応じて `.agent/docs/` のドキュメントが更新されている

## 🤖 Copilot の動作

### 仕様更新の自動提案

仕様に影響するコード変更を検出した場合:

1. **積極的に提案**: 仕様更新を自動的に提案
2. **差分を表示**: 更新が必要な内容の差分を表示
3. **確認を求める**: 更新前に確認を求める

**提案の例**:
```
コードを変更しました。以下の仕様ファイルも更新が必要です:

.agent/specs/drinks-api.md:
- [ ] 新しい `filterByDateRange` パラメータを追加
- [ ] レスポンススキーマを更新

更新しますか?
```

### PR 作成サポート

コード変更が PR の準備ができた場合:

1. **チェック**: `.agent/specs/` の更新が必要かどうか確認
2. **PR 説明文を生成**: 以下を含める
   - 変更内容のサマリー
   - 関連する仕様へのリンク
   - レビュアー用のチェックリスト
3. **検証**: GitHub Issue のリンクを確認

### ドキュメントメンテナンス

- **自動検出**: `.agent/docs/` 内の未解決の質問が議論で解決された場合に検出
- **移動を提案**: 解決済みの項目を `.agent/specs/` に移動することを提案
- **整理**: QA リストをカテゴリ別に整理された状態に保つ

## 📌 GitHub Issues との連携

- `.agent/docs/` のタスクは GitHub Issues を参照: `#123`
- 一貫性のために GitHub Issue テンプレートを使用
- タスク完了時に Issue のステータスを更新
- PR を Issue に自動的にリンク: `Closes #123`

## 🎯 ベストプラクティス

1. **信頼できる唯一の情報源**: `.agent/specs/` は常に最新の状態に保つ
2. **「どのように」ではなく「なぜ」を記録**: 根拠とコンテキストに焦点を当てる
3. **ドキュメントは軽量に**: 情報の重複を避ける
4. **コピーせずリンク**: 可能な限り既存のドキュメントを参照
5. **バージョンコンテキスト**: トレーサビリティのために日付と Issue 番号を含める

## 🚨 よくある間違い

- ❌ 仕様を更新せずにコードを更新する
- ❌ 実装なしで仕様を作成する
- ❌ 複数のファイルに情報を重複させる
- ❌ GitHub Issues へのリンクを忘れる
- ❌ 解決済みの質問を `.agent/docs/` に無期限に残す
